<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Folk Song Collection - Traditional Music and Ballads</title>
  <link rel="stylesheet" href="andreas01.css" media="screen,projection" />
  <link rel="stylesheet" href="print.css" media="print" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .action-button {
      padding: 10px 20px;
      background-color: #808080;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }
    .action-button:hover {
      background-color: #666666;
    }
    #visualizer {
      display: block;
      margin: 0 auto 20px auto;
      background-color: black;
      border: 2px solid #444;
    }
    .song-list li {
      position: relative;
      cursor: pointer;
      margin-bottom: 6px;
      text-decoration: underline;
    }
    .hover-box {
      display: block;
      position: absolute;
      background-color: #fdfefe;
      border: 1px solid #bbb;
      padding: 12px;
      z-index: 1;
      white-space: pre-wrap;
      width: 260px;
      max-height: 80vh;
      overflow-y: auto;
      top: -10px;
      left: calc(100% + 10px);
      box-shadow: 2px 4px 8px rgba(0, 0, 0, 0.15);
      border-radius: 6px;
      font-size: 12px;
      line-height: 1.5;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }
    .song-list li:hover .hover-box {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>
<div id="wrap">
  <div id="header"><h1><a href="#">Folksong Collection</a></h1></div>

  <canvas id="visualizer" width="760" height="190"></canvas>

  <div id="leftside">
    <ul class="avmenu">
      <li><a href="Tracks.html">All Tracks</a></li>
      <li><a href="blues.html">Blues</a></li>
      <li><a href="childballads.html">Child Ballads</a></li>
      <li><a href="childrensongs.html">Children's Songs</a></li>
      <li><a href="christmas.html">Christmas</a></li>
      <li><a href="country.html">Country</a></li>
      <li><a href="folk.html">Folk Songs</a></li>
      <li><a href="irish.html">Irish</a></li>
      <li><a href="gospel.html">Gospel</a></li>
      <li><a href="scottish.html">Scottish</a></li>
      <li><a href="shanties.html">Shanties</a></li>
    </ul>
  </div>

  <div id="contentwide">
    <h1>Audio Player</h1>
    <audio id="audio-player" controls>Your browser does not support the audio element.</audio>
    <ul class="song-list" id="playlist"></ul>
    <div class="button-group">
      <button class="action-button" id="clear-playlist">Clear Playlist</button>
      <button class="action-button" id="share-playlist">Share Playlist</button>
    </div>
  </div>

  <div id="footer">
    <p>&copy; 2024 <a href="img/PatMcD4x4.jpg">Thomas Patrick McDonnell</a> &middot; | <a href="homepage.html">Homepage</a></p>
  </div>

<script>
const audioPlayer = document.getElementById('audio-player');
const playlist = document.getElementById('playlist');
const clearButton = document.getElementById('clear-playlist');
const shareButton = document.getElementById('share-playlist');
let currentSongIndex = 0;

const baseUrl = 'https://patrickmcdonnell.github.io/FolkSongs/';

async function initializePlaylist() {
  const songPaths = new URLSearchParams(window.location.search).get('songs')?.split(';') || [];
  if (songPaths.length === 0) {
    return;
  }

  playlist.innerHTML = ''; // Clear the existing playlist

  songPaths.forEach(async (path, index) => {
    const title = decodeURIComponent(path.split('/').pop()).replace(/\.mp3$/, '');
    const li = document.createElement('li');
    li.textContent = title;
    li.setAttribute('data-src', baseUrl + decodeURIComponent(path));

    const hover = document.createElement('div');
    hover.className = 'hover-box';
    hover.textContent = await fetchSongComments(decodeURIComponent(path));
    li.appendChild(hover);

    li.addEventListener('click', () => {
      currentSongIndex = index;
      audioPlayer.src = li.getAttribute('data-src');
      audioPlayer.play();
    });

    playlist.appendChild(li);
  });

  // Play the first song in the list
  if (songPaths.length > 0) {
    audioPlayer.src = baseUrl + decodeURIComponent(songPaths[0]);
    audioPlayer.play();
    console.log('First song playing:', songPaths[0]); // Log the first song
    audioPlayer.addEventListener('ended', playNextSong);
  }
}


// Fetch comments from the Tracks.html file
async function fetchSongComments(songPath) {
  try {
    const response = await fetch(baseUrl + 'Tracks.html');
    const html = await response.text();
    const doc = new DOMParser().parseFromString(html, 'text/html');
    const items = doc.querySelectorAll('li');
    for (let item of items) {
      const src = item.getAttribute('data-src');
      if (src && decodeURIComponent(src).endsWith(songPath)) {
        const hoverBox = item.querySelector('.hover-box');
        return hoverBox ? hoverBox.textContent : '';
      }
    }
  } catch (e) {
    console.error('Error fetching comments:', e);
  }
  return '';
}

// Move to the next song after the current one ends
function playNextSong() {
  console.log('Current song index before increment:', currentSongIndex);
  currentSongIndex++;
  if (currentSongIndex >= playlist.children.length) {
    currentSongIndex = 0; // Loop back to the first song
  }
  console.log('Current song index after increment:', currentSongIndex);
  const nextSong = playlist.children[currentSongIndex];
  audioPlayer.src = nextSong.getAttribute('data-src');
  audioPlayer.play();
}



audioPlayer.addEventListener('ended', () => {
  console.log('Song ended, triggering playNextSong...');
  playNextSong();
});

// Clear Playlist Button
clearButton.addEventListener('click', () => {
  playlist.innerHTML = ''; // Clear the playlist
  audioPlayer.pause();
  audioPlayer.src = ''; // Stop the audio player
});

// Share Playlist Button
shareButton.addEventListener('click', () => {
  const songPaths = Array.from(playlist.children)
    .map(li => li.getAttribute('data-src'))
    .join(';');
  const url = `${window.location.origin}?songs=${encodeURIComponent(songPaths)}`;
  prompt('Share this playlist link:', url); // Prompt user to copy the URL
});

// Initialize the playlist on page load
document.addEventListener('DOMContentLoaded', initializePlaylist);
</script>

</body>
</html>


